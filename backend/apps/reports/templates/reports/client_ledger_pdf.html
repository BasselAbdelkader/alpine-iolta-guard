{% load accounting_filters %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DEBUGGING - Client Ledger Report</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; font-size: 12px; }
        .header { text-align: center; border-bottom: 2px solid #333; margin-bottom: 20px; padding-bottom: 15px; }
        .header h1 { margin: 0; color: #333; font-size: 20px; }
        .info-section { margin-bottom: 20px; }
        .summary-box { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin-bottom: 20px; }
        .summary-row { display: flex; justify-content: space-around; }
        .summary-item { text-align: center; }
        .summary-label { font-weight: bold; font-size: 11px; color: #666; }
        .summary-value { font-size: 14px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; font-size: 10px; }
        th { background-color: #f8f9fa; font-weight: bold; }
        .amount { text-align: right; font-family: monospace; }
        .text-success { color: #28a745; }
        .text-danger { color: #dc3545; }
        .text-primary { color: #007bff; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Trust Account Client Ledger</h1>
        {% if selected_client %}
            <h2>{{ selected_client.full_name }}</h2>
            {% if selected_case %}
                <h3>{{ selected_case.case_number }}</h3>
            {% endif %}
        {% endif %}
    </div>
    
    <div class="info-section">
        <strong>Report Period:</strong> {{ date_from|date:"m/d/Y" }} to {{ date_to|date:"m/d/Y" }}<br>
        <strong>Generated:</strong> {{ report_generated|date:"m/d/Y g:i A" }}<br>
        <strong>Total Transactions:</strong> {{ transaction_count }}
    </div>
    
    {% if transaction_items %}
    <div class="summary-box">
        <div class="summary-row">
            <div class="summary-item">
                <div class="summary-label">Total Deposits</div>
                <div class="summary-value text-success">{{ total_deposits|format_amount_accounting }}</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Total Withdrawals</div>
                <div class="summary-value text-danger">{{ total_withdrawals|format_amount_accounting }}</div>
            </div>
            <div class="summary-item">
                <div class="summary-label">Current Balance</div>
                <div class="summary-value text-primary">{{ current_balance|format_amount_accounting }}</div>
            </div>
        </div>
    </div>
    
    <table>
        <thead>
            <tr>
                <th>Date</th>
                <th>Type</th>
                <th>Ref</th>
                <th>Payee</th>
                <th>Description</th>
                <th class="amount">Amount</th>
                <th class="amount">Balance</th>
            </tr>
        </thead>
        <tbody>
            {% for item in transaction_items %}
            <tr>
                <td>{{ item.transaction_date|date:"m/d/Y" }}</td>
                <td>{{ item.get_transaction_type_display }}</td>
                <td>{% if item.case %}{{ item.case.case_number }}{% else %}-{% endif %}</td>
                <td>
                    {% if item.vendor %}
                        {{ item.vendor.vendor_name }}
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td>{{ item.description|default:item.description }}</td>
                <td class="amount">
                    {% if item.transaction_type == 'DEPOSIT' %}
                        {{ item.amount|format_deposit }}
                    {% else %}
                        {{ item.amount|format_withdrawal }}
                    {% endif %}
                </td>
                <td class="amount">
                    {{ item.running_balance|format_amount_accounting }}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% endif %}
    
    <div style="margin-top: 20px; font-size: 10px; color: #666;">
        Generated on {{ report_generated|date:"m/d/Y g:i A" }} - Trust Account Management System
    </div>
</body>
</html>